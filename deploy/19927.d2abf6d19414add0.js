"use strict";(self.webpackChunkJbNotifier=self.webpackChunkJbNotifier||[]).push([[19927],{19927:(nt,p,a)=>{a.r(p),a.d(p,{NotificationSettingsModule:()=>tt});var x=a(96814),S=a(31610),u=a(88762),m=a(23758);const b=[{dataField:"items",template:"notification-setting-definition",label:{visible:!1}}];var T=a(37398),_=a(99397),v=a(94664),f=a(6990),t=a(19212),N=a(53009),A=a(24270),D=a(10829),I=a(71036),F=a(95013),Z=a(27310),M=a(11028),V=a(78012),J=a(16358),h=a(61708),E=a(66782),G=a(20843),k=a(609),H=a(10518),Q=a(74291),K=a(21137);let $=(()=>{class n{constructor(e){this.numberbox=e,this.numberbox.elementAttr={class:"custom-number-box"},this.numberbox.hoverStateEnabled=!1,this.numberbox.focusStateEnabled=!1,this.numberbox.activeStateEnabled=!1}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(h.G))};static#e=this.\u0275dir=t.lG2({type:n,selectors:[["","appNumberBox",""]],standalone:!0})}return n})();function B(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"dx-select-box",9),t.NdJ("valueChange",function(i){t.CHM(e);const o=t.oxw();return t.KtG(o.saveAndDisplayTenantId=i)})("onValueChanged",function(i){t.CHM(e);const o=t.oxw();return t.KtG(o.onTenantChanged(i))}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(),t.Q6J("dataSource",e.tenantsLookupDataSource)("value",e.saveAndDisplayTenantId)}}function O(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div")(1,"div",10)(2,"div",11),t._uU(3),t.qZA(),t.TgZ(4,"div",12)(5,"dx-text-box",13),t.NdJ("valueChange",function(i){t.CHM(e);const o=t.oxw();return t.KtG(o.item.value=i)})("onValueChanged",function(i){t.CHM(e);const o=t.oxw();return t.KtG(o.onSettingValueChanged(i))}),t.qZA()(),t.TgZ(6,"div")(7,"dx-button",14),t.NdJ("onClick",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.item.value=i.item.defaultValue)}),t.ALo(8,"abpLocalization"),t.qZA()()()()}if(2&n){const e=t.oxw();t.xp6(3),t.hij(" ",e.item.displayName," "),t.xp6(2),t.Q6J("value",e.item.value),t.xp6(2),t.Q6J("text",t.lcZ(8,3,"::\u9084\u539f\u9810\u8a2d\u503c"))}}const j=(n,c)=>c.id;function L(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"dx-text-box",20),t.NdJ("valueChange",function(i){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=i)})("onValueChanged",function(i){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(i))}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function P(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"dx-date-box",21),t.NdJ("valueChange",function(i){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=i)})("onValueChanged",function(i){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(i))}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function U(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"dx-number-box",22),t.NdJ("valueChange",function(i){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=i)})("onValueChanged",function(i){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(i))}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function w(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"dx-check-box",23),t.NdJ("valueChange",function(i){t.CHM(e);const o=t.oxw().$implicit;return t.KtG(o.value=i)})("onValueChanged",function(i){t.CHM(e);const o=t.oxw(3);return t.KtG(o.onSettingValueChanged(i))}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("value",e.value)}}function z(n,c){if(1&n){const e=t.EpF();t.TgZ(0,"div",15)(1,"div",11),t._uU(2),t.qZA(),t.TgZ(3,"div"),t.YNc(4,L,1,1,"dx-text-box",16)(5,P,1,1,"dx-date-box",17)(6,U,1,1,"dx-number-box",18)(7,w,1,1,"dx-check-box",19),t.qZA(),t.TgZ(8,"div")(9,"dx-button",14),t.NdJ("onClick",function(){const o=t.CHM(e).$implicit;return t.KtG(o.value=o.defaultValue)}),t.ALo(10,"abpLocalization"),t.qZA()()()}if(2&n){const e=c.$implicit;t.xp6(2),t.hij(" ",e.displayName," "),t.xp6(2),t.Q6J("ngIf","string"===e.dataType),t.xp6(),t.Q6J("ngIf","datetime"===e.dataType),t.xp6(),t.Q6J("ngIf","int"===e.dataType),t.xp6(),t.Q6J("ngIf","bool"===e.dataType),t.xp6(2),t.Q6J("text",t.lcZ(10,6,"::\u9084\u539f\u9810\u8a2d\u503c"))}}function Y(n,c){if(1&n&&(t.TgZ(0,"div"),t.SjG(1,z,11,8,"div",24,j),t.qZA()),2&n){const e=t.oxw();t.xp6(),t.wJu(e.formData.items)}}const R=()=>({class:"custom-button custom-button--blue"}),X=[{path:"",component:(()=>{class n{constructor(e,s,i,o){this.appRestService=e,this.configStateService=s,this.toastService=i,this.lookupDataSourceService=o,this.formItems=b,this.formData={items:[]},this.isDirty=!1,this.isSaveAndDisplayTenantIdFirstChanged=!0,this.getSettingUrl=l=>l?`/api/app/jbnotifier-admin/notification-settings?SpecifiedTenantId=${l}`:"/api/app/jbnotifier-admin/notification-settings",this.getSettings=l=>{const d=this.getSettingUrl(l);return this.appRestService.request({method:"GET",url:d}).pipe((0,T.U)(g=>{const C=g.map(r=>{const et=((n,c)=>{switch(c){case"int":return parseInt(n,10);case"string":return String(n);case"datetime":return new Date(n);case"bool":return"true"===n;default:throw new Error(`Unsupported data type: ${c}`)}})(r.notificationSetting.value,r.notificationSettingDefinition.dataType);return{notificationSettingDefinitionId:r.notificationSettingDefinition.id,value:et,isInherited:r.notificationSetting.isInherited,defaultValue:r.notificationSettingDefinition.defaultValue,displayName:r.notificationSettingDefinition.displayName,dataType:r.notificationSettingDefinition.dataType}});return this.originSettings=(0,f.cloneDeep)(C),{items:C}})).pipe((0,_.b)(g=>{this.formData=g}))},this.saveSettings=()=>{const l=this.formData.items.map(d=>({notificationSettingDefinitionId:d.notificationSettingDefinitionId,value:String(d.value),isInherited:d.isInherited}));this.appRestService.request({method:"PUT",url:`/api/app/jbnotifier-admin/notification-settings?SpecifiedTenantId=${this.saveAndDisplayTenantId}`,body:l}).pipe((0,v.w)(()=>this.getSettings(this.saveAndDisplayTenantId))).subscribe(()=>{this.toastService.success("\u5132\u5b58\u6210\u529f!")})}}ngOnInit(){this.currentTenantId=this.configStateService.getOne("currentUser").tenantId,this.currentTenantId&&(this.saveAndDisplayTenantId=this.currentTenantId),this.currentTenantId?this.getSettings(this.currentTenantId).subscribe():this.getTenantLookup().pipe((0,v.w)(e=>this.getSettings(this.saveAndDisplayTenantId))).subscribe()}getTenantLookup(){return this.tenantsLookupDataSource=this.lookupDataSourceService.getLookupDataSource({dataField:"tenant",path:"/api/app/jbnotifier-admin/notification-settings/tenant-lookup"}),this.appRestService.request({method:"GET",url:"/api/app/jbnotifier-admin/notification-settings/tenant-lookup?MaxResultCount=1"}).pipe((0,_.b)(e=>{this.saveAndDisplayTenantId=e.items[0]?.id}))}onTenantChanged(e){this.saveAndDisplayTenantId=e.value,this.isSaveAndDisplayTenantIdFirstChanged||this.getSettings(this.saveAndDisplayTenantId).subscribe(),this.isSaveAndDisplayTenantIdFirstChanged&&(this.isSaveAndDisplayTenantIdFirstChanged=!1)}onSettingValueChanged(){const e=!(0,f.isEqual)(this.originSettings,this.formData.items);this.isDirty=e}static#t=this.\u0275fac=function(s){return new(s||n)(t.Y36(N.$),t.Y36(u.XJE),t.Y36(A.P),t.Y36(D.V))};static#e=this.\u0275cmp=t.Xpm({type:n,selectors:[["app-notification-settings"]],decls:13,vars:14,consts:[[1,"notification-settings","paper-1","d-flex","flex-column","align-items-center","h-100"],[1,"flex-grow-1","d-flex","flex-column","justify-content-center"],[1,"mb-3"],[1,"dx-form-group-caption","text-center","mb-2"],[4,"ngIf"],["appFormFeature","",3,"items","formData"],[4,"dxTemplate","dxTemplateOf"],[1,"d-flex","justify-content-center"],["appCustomButton","",3,"elementAttr","text","disabled","onClick"],["appSelectBox","","displayExpr","displayName","valueExpr","id",3,"dataSource","value","valueChange","onValueChanged"],[1,"d-flex","align-items-center","mb-3"],[1,"dx-field-item-label-text"],[1,"ps-3","pe-3"],["valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["icon","refresh",3,"text","onClick"],[1,"notification-setting"],["appTextBox","","valueChangeEvent","keyup",3,"value","valueChange","onValueChanged",4,"ngIf"],["valueChangeEvent","keyup","dateSerializationFormat","yyyy-MM-ddTHH:mm:ss.SSS+08:00",3,"value","valueChange","onValueChanged",4,"ngIf"],["appNumberBox","","valueChangeEvent","keyup",3,"value","valueChange","onValueChanged",4,"ngIf"],["appCheckBox","","valueChangeEvent","keyup",3,"value","valueChange","onValueChanged",4,"ngIf"],["appTextBox","","valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["valueChangeEvent","keyup","dateSerializationFormat","yyyy-MM-ddTHH:mm:ss.SSS+08:00",3,"value","valueChange","onValueChanged"],["appNumberBox","","valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["appCheckBox","","valueChangeEvent","keyup",3,"value","valueChange","onValueChanged"],["class","notification-setting"]],template:function(s,i){1&s&&(t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),t._uU(4),t.ALo(5,"abpLocalization"),t.qZA(),t.YNc(6,B,2,2,"div",4),t.qZA(),t.TgZ(7,"dx-form",5),t.YNc(8,O,9,5,"div",6)(9,Y,3,0,"div",6),t.qZA()(),t.TgZ(10,"div",7)(11,"dx-button",8),t.NdJ("onClick",function(){return i.saveSettings()}),t.ALo(12,"abpLocalization"),t.qZA()()()),2&s&&(t.xp6(4),t.hij(" ",t.lcZ(5,9,"JbNotifier::Permission:NotificationSettings")," "),t.xp6(2),t.Q6J("ngIf",!i.currentTenantId),t.xp6(),t.Q6J("items",i.formItems)("formData",i.formData),t.xp6(),t.Q6J("dxTemplateOf","string"),t.xp6(),t.Q6J("dxTemplateOf","notification-setting-definition"),t.xp6(2),t.Q6J("elementAttr",t.DdM(13,R))("text",t.lcZ(12,11,"AbpUi::Save"))("disabled",!i.isDirty))},dependencies:[x.O5,I._,F.A,Z.A,M.w,V.m,J.K,G.p6,h.G,E.M,k.Y,H._,Q.I,K.v,$,u.fuE],styles:[".notification-settings[_ngcontent-%COMP%]{background-color:var(--lpx-content-background)}.notification-settings[_ngcontent-%COMP%]   .notification-setting[_ngcontent-%COMP%]{display:flex;align-items:center;gap:16px;margin-top:16px}.notification-settings[_ngcontent-%COMP%]   .notification-setting[_ngcontent-%COMP%]:first-child{margin-top:0}.notification-settings[_ngcontent-%COMP%]   .notification-setting[_ngcontent-%COMP%] > div[_ngcontent-%COMP%]{flex:1}"]})}return n})(),canActivate:[u.a1M,u.nG9]}];let W=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[m.Bz.forChild(X),m.Bz]})}return n})();var q=a(5533);let tt=(()=>{class n{static#t=this.\u0275fac=function(s){return new(s||n)};static#e=this.\u0275mod=t.oAB({type:n});static#n=this.\u0275inj=t.cJS({imports:[x.ez,W,S.m,q.P]})}return n})()}}]);